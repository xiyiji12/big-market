# 大营销抽奖系统

# 第1节课：抽奖策略和库表设计

创建4个表：award、strategy、strategy_award、strategy_rule

# 第2节课：基础层持久化数据

编写po层4个表对应的实体对象类；dao层的对应接口；mapper层。

# 第3节课：策略概率装配处理

两种抽奖算法方式：
循环比对：根据概率值创建出累加的范围
索引获取（用这个）：存到map，用空间换时间，把随机值当索引使用，直接获取对应的奖品结果
实现流程：
1.配置redis
2.数据库操作(strategy_award_mapper)
3.实现装配(strategyAmory)：
    策略装配库：
            1).查询策略配置 
            2).最小概率 
            3).概率和
            4).概率和/最小概率=概率范围 
            5).list存对应奖品
            6).乱序操作 
            7).存到map(key:从0开始，value:奖品id) 
            8).把map存到redis
4.仓储实现，提供数据服务，热点信息存到redis(strategyRepository)：策略id,策略奖品表需要的字段(对应mapper的select字段)，策略概率范围，策略概率表(map)
5.抽奖：通过策略id抽奖，获取概率值奖品查找表的结果

# 第4节课：策略权重概率装配：满足支持用户满足抽奖N积分后可中奖的设定

1.拆分装配接口，一个装配一个调度接口
2.增加装配权重策略相关代码
3.仓储实现，提供数据服务:
    策略奖品表需要的字段(对应mapper的select字段)、策略表需要的字段(对应mapper的select字段);
    随机策略：一个概率范围、一个概率查找表（map）;
    权重策略：三个概率范围(4000、5000、6000对应的)、三个概率查找表（map：4000、5000、6000）;
4.抽奖：通过策略id+权重值组合方式，获取概率值奖品查找表的结果

# 第5节课：抽奖前置规则过滤：实现抽奖前权重和黑名单规则，抽奖前进行过滤

如果超过N积分可以在限定范围内抽奖，如果是黑名单范围的用户，只返回固定的奖品ID
模板方法模式：在抽象类中实现了执行抽奖的方法模板，其中方法模板里的过滤规则定义了一个抽象方法，用子类具体实现抽奖前的过滤规则
工厂模式：把接口实现的类一块注入进去再创建对象；
策略模式：定义了一系列算法，并将每个算法封装起来，使它们可以相互替换，且算法的变化不会影响使用算法的客户端。
注意：测试的时候除了清缓存还要装配才能抽奖

# 第6节课：责任链模式处理抽奖规则--解决前置过滤规则中的抽奖行为臃肿

抽奖前置规则：黑名单策略、权重策略、白名单（默认）策略；之间是互斥的
100001策略表的rule_models有rule_weight、rule_blacklist，在抽奖时如果rule_models为空走默认策略，
如果不为空把rule_weight、rule_blacklist加入责任链中，先走rule_weight，看看测试的权重数能否找到最小满足的权重数，
如果能找到就返回奖品id；找不到就走下一个责任链rule_blacklist，查rule_value中的黑名单用户，看看测试的用户id是否
在黑名单中，如果在，就返回黑名单对应的奖品id：100，如果不在就走下一个责任链也就是默认抽奖规则进行兜底。
